# Test info

- Name: should trigger an automation when a calendly invite is created
- Location: /home/runner/work/engine/engine/e2e/automation/trigger/integration/calendly/invite-created.spec.ts:6:1

# Error details

```
Error: page.waitForURL: Target page, context or browser has been closed
=========================== logs ===========================
  "domcontentloaded" event fired
============================================================
    at /home/runner/work/engine/engine/e2e/steps.ts:37:17
    at connectTo (/home/runner/work/engine/engine/e2e/steps.ts:30:3)
    at /home/runner/work/engine/engine/e2e/automation/trigger/integration/calendly/invite-created.spec.ts:13:3
```

# Page snapshot

```yaml
- heading "Admin" [level=3]
- text: Application
- list:
  - listitem:
    - link "Dashboard":
      - /url: /admin
- text: Forms
- list:
  - listitem:
    - link "Forms":
      - /url: /admin/forms
- text: Automations
- list:
  - listitem:
    - link "Automations":
      - /url: /admin/automations
  - listitem:
    - link "Runs":
      - /url: /admin/runs
  - listitem:
    - link "Connections":
      - /url: /admin/connections
- text: Tables
- list:
  - listitem:
    - link "Tables":
      - /url: /admin/tables
- text: Resources
- list:
  - listitem:
    - link "OpenAPI":
      - /url: /admin/openapi
- list:
  - listitem:
    - button "admin@admin.com"
- main:
  - button "Toggle Sidebar"
  - navigation "breadcrumb":
    - list:
      - listitem:
        - link "Connections" [disabled]
  - textbox "Search..."
  - table:
    - rowgroup:
      - row "Name Service Auth Type Connection":
        - cell "Name"
        - cell "Service"
        - cell "Auth Type"
        - cell "Connection"
        - cell
    - rowgroup:
      - row "Calendly calendly OAuth Disconnected Open menu":
        - cell "Calendly"
        - cell "calendly"
        - cell "OAuth"
        - cell "Disconnected"
        - cell "Open menu":
          - button "Open menu"
```

# Test source

```ts
   1 | import { expect, test, type Page } from '@playwright/test'
   2 |
   3 | export async function loginToAdmin(page: Page) {
   4 |   await test.step('Login as admin', async () => {
   5 |     await page.goto('/admin/login')
   6 |     await page.locator('input#email').fill('admin@admin.com')
   7 |     await page.locator('input#password').fill('admin')
   8 |     await page.locator('button[type="submit"]').click()
   9 |     await page.waitForURL('/admin')
  10 |     await expect(page.getByRole('heading', { name: 'Dashboard', level: 1 })).toBeVisible()
  11 |   })
  12 | }
  13 |
  14 | export async function connectTo(
  15 |   service: 'calendly' | 'google' | 'facebook' | 'linkedin' | 'youcanbookme',
  16 |   page: Page
  17 | ) {
  18 |   let loginUrl: string
  19 |   if (service === 'calendly') {
  20 |     loginUrl = 'https://calendly.com/app/login'
  21 |   } else if (service === 'google') {
  22 |     loginUrl = 'https://accounts.google.com/o/oauth2/v2/auth'
  23 |   } else if (service === 'facebook') {
  24 |     loginUrl = 'https://www.facebook.com/v18.0/dialog/oauth'
  25 |   } else if (service === 'linkedin') {
  26 |     loginUrl = 'https://www.linkedin.com/oauth/v2/authorization'
  27 |   } else if (service === 'youcanbookme') {
  28 |     loginUrl = 'https://app.youcanbook.me/oauth/authorize'
  29 |   }
  30 |   await test.step(`Connect to ${service}`, async () => {
  31 |     await page.goto('/admin/connections')
  32 |     await page.getByRole('button', { name: 'Open menu' }).click()
  33 |     const [popup] = await Promise.all([
  34 |       page.waitForEvent('popup'),
  35 |       page.getByRole('menuitem', { name: 'Connect account' }).click(),
  36 |     ])
> 37 |     await popup.waitForURL(loginUrl)
     |                 ^ Error: page.waitForURL: Target page, context or browser has been closed
  38 |     await popup.goto(`/api/connections/auth?id=1&code=AUTH_CODE`)
  39 |     await popup.close()
  40 |     await page.reload()
  41 |     await expect(page.getByRole('cell', { name: 'Connected', exact: true })).toBeVisible()
  42 |   })
  43 | }
  44 |
```